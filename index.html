<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>City Metro</title>
  <link rel="stylesheet" href="leaflet.css" />
  <style>
    html, body {
      margin: 0; padding: 0;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      background: #eee;
    }

    #map {
      width: clamp(1024px, 80vw, 1920px);
      height: clamp(768px, 60vh, 1080px);
      border: 2px solid #444;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
    }
  </style>
</head>
<body>
  <div id="map"></div>

  <script src="leaflet.js"></script>
  <script>
    const imageWidth = 5800;
    const imageHeight = 470;
    const bounds = [[0, 0], [imageHeight, imageWidth]];

    const map = L.map('map', {
      crs: L.CRS.Simple,
      minZoom: -3,
      maxZoom: 4,
      zoomSnap: 0.1,
      zoomDelta: 0.5,
      zoomControl: true,
      maxBounds: bounds,
    });

    L.imageOverlay('Lego City County Metro June 2025.png', bounds).addTo(map);

    map.fitBounds(bounds);

    // Adjust zoom so image fits map container width-wise or height-wise
    function updateZoom() {
      const mapDiv = document.getElementById('map');
      const containerWidth = mapDiv.clientWidth;
      const containerHeight = mapDiv.clientHeight;

      // Calculate zoom based on width and height scaling factors
      const zoomWidth = Math.log2(containerWidth / imageWidth);
      const zoomHeight = Math.log2(containerHeight / imageHeight);

      // Use smaller zoom to fit entire image inside container (letterbox)
      const zoom = Math.min(zoomWidth, zoomHeight);

      map.setZoom(zoom);
      map.setView([imageHeight / 2, imageWidth / 2], zoom);
    }

    updateZoom();

    window.addEventListener('resize', updateZoom);

    // Transit lines
    const lines = {
      'A Line (Blue)': {
        color: 'blue',
        coords: [[440,150],[420,750],[380,1500],[340,2600],[300,3700],[280,4800],[260,5700]]
      },
      'B Line (Red)': {
        color: 'red',
        coords: [[430,500],[400,1300],[360,2000],[310,2900],[280,3900],[250,4800],[230,5700]]
      },
      'D Line (Purple)': {
        color: 'purple',
        coords: [[450,1200],[420,1700],[390,2300],[360,3000],[330,3700],[300,4600],[280,5400]]
      },
      'E Line (Yellow)': {
        color: 'yellow',
        coords: [[460,1400],[430,1900],[400,2500],[370,3200],[340,3900],[300,4600]]
      },
      'G Line (Orange)': {
        color: 'orange',
        coords: [[440,1000],[410,1400],[380,1900],[350,2400],[320,2900],[300,3500]]
      },
      'J Line (Silver)': {
        color: 'gray',
        coords: [[430,800],[400,1100],[370,1500],[340,2000],[310,2600],[280,3200]]
      },
      'K Line (Pink)': {
        color: 'deeppink',
        coords: [[440,1200],[420,1600],[400,2000],[380,2400],[350,2800],[320,3200]]
      },
      'Sun City Ferry (Green)': {
        color: 'green',
        coords: [[470,0],[460,400],[450,700],[430,1000]]
      }
    };

    for (const [name, line] of Object.entries(lines)) {
      L.polyline(line.coords, {
        color: line.color,
        weight: 5,
        opacity: 0.9,
        smoothFactor: 1
      }).addTo(map).bindPopup(name);
    }

    // Simulated red train dot
    const train = L.circleMarker([440, 150], {
      radius: 8,
      color: 'red',
      fillColor: '#f03',
      fillOpacity: 1
    }).addTo(map);

    let x = 150;
    let y = 440;
    setInterval(() => {
      x += 10;
      y -= 1;
      if (x > 5700 || y < 10) {
        x = 150;
        y = 440;
      }
      train.setLatLng([y, x]);
    }, 100);
  </script>
</body>
</html>
